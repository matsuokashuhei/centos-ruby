- name: 依存パッケージのインストール
  become: yes 
  yum:  name={{ item }} state=installed
  with_items:
  - openssl-devel
  - readline-devel
  - zlib-devel
  - libcurl-devel
  - sqlite-devel
- name: rbenvグループの作成
  become: yes
  group: name=rbenv state=present
#   - name: rbenvのチェック
#     become: yes
#     #become_method: su
#     shell: which rbenv; echo $?
#     register: result
#     ignore_errors: True
- name: rbenvのインストール
  become: yes
  git:  repo=git://github.com/sstephenson/rbenv.git dest=/usr/local/rbenv force=yes
  #when: result.stdout != '0'
- name: rbenvの権限
  become: yes
  file: path=/usr/local/rbenv owner=root group=rbenv mode=775 recurse=yes
  #when: result.stdout != '0'
- name: /usr/local/rbenv/{shims,versions,plugins}の作成
  become: yes
  file: path=/usr/local/rbenv/{{ item }} state=directory owner=root group=rbenv mode=0775 recurse=yes
  with_items:
  - shims
  - versions
  - plugins
  #when: result.stdout != '0'
- name: ruby-buildのインストール
  become: yes
  git: repo=git://github.com/sstephenson/ruby-build.git dest=/usr/local/rbenv/plugins/ruby-build force=yes
  #when: result.stdout != '0'
- name: ruby-buildの権限
  become: yes
  file: path=/usr/local/rbenv/plugins/ruby-build owner=root group=rbenv mode=775 recurse=yes
  #when: result.stdout != '0'
- name: /etc/profile.d/rbenv.shの作成
  become: yes
  copy: src=files/rbenv.sh dest=/etc/profile.d/rbenv.sh
  #when: result.stdout != '0'
- name: /usr/local/rbenv/default-gemsの作成
  become: yes
  copy: src=files/default-gems dest=/usr/local/rbenv/default-gems
  #when: result.stdout != '0'
#   - name: source rbenv.sh
#     become: yes
#     shell: source /etc/profile.d/rbenv.sh
#     #when: result.stdout != '0'
#    - name: rubyのチェック
#      become: yes
#      shell: which ruby; echo $?
#      register: result
#      ignore_errors: True
- name: rbenv install 2.3.0
  become: yes
  shell: source /etc/profile.d/rbenv.sh && rbenv install 2.3.0
  #when: result.stdout != '0'
- name: rbenv global 2.3.0
  become: yes
  shell: source /etc/profile.d/rbenv.sh && rbenv global 2.3.0
  #when: result.stdout != '0'

